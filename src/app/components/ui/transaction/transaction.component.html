<div class="card">
    <!-- HEADER -->
    <div class="card-header bg-primary text-white">
        <div class="container p-0">
            <div class="row no-gutters">
                <div class="col"><p class="lead m-0">{{data.book.author}}</p></div>
                <div class="col"><p class="lead m-0">ISBN</p></div>
                <div class="col-2"><p class="lead m-0 text-right">Stato</p></div>
            </div>
            <div class="row no-gutters">
                <div class="col"><h3 class="m-0">{{data.book.title}}</h3></div>
                <div class="col"><h3 class="m-0">{{data.book.isbn}}</h3></div>
                <div class="col-2"><h3 class="m-0 text-right">{{data.status | transactionStatus}}</h3></div>
            </div>
        </div>
    </div>

    <!-- SALES LIST -->
    <div class="card-body p-0 border-top-0" *ngIf="data.status === 'free'">
        <table class="table table-striped table-vcenter m-0">
            <tbody>
                <tr *ngFor="let sale of data.sales">
                    <td style="width: 20%">{{sale.seller.firstName}} {{sale.seller.lastName}}</td>
                    <td style="width: 20%">{{sale.status | transactionStatus}}</td>
                    <td style="width: 20%">{{sale.bookStatus | bookStatus}}</td>
                    <td style="width: 20%">{{sale.additionalMaterial ? 'Materiale addizionale fornito' : 'Nessun materiale addizionale'}}</td>
                    <td class="text-right">
                        <button class="btn btn-secondary btn-sm" [disabled]="sale.status !== 'free'" (click)="pairTransaction(data, sale)">Contatta</button>
                    </td>
                </tr>

                <tr *ngIf="data.sales && data.sales.length === 0">
                    <td colspan="5">Nessun libro disponibile al momento! Controlla periodicamente l'inserimento di nuovi libri nel circuito.</td>
                </tr>

                <tr *ngIf="!data.sales">
                    <td colspan="5">Nessun acquirente ti ha ancora contattato. Nel caso succedesse ti arriverà una notifica via e-mail.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- INFO BOX -->
    <div class="card-body p-0 border-top-0" *ngIf="data.status === 'pending' || data.status === 'notResponding'">
        <div class="container p-0">
            <div class="row no-gutters">
                <div class="col">
                    <h1>{{data.pairedUser.firstName}} {{data.pairedUser.lastName}}</h1>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CHAT HEADER -->
<!-- <div class="collapsible transaction__chat-header" *ngIf="data.status === 'pending' || data.status === 'notResponding'">
    <div class="container container--column">
        <div class="container container--no-padding">
            <h1>{{data.pairedUser.firstName}} {{data.pairedUser.lastName}}</h1>
        </div>
        <div class="container container--no-padding container--margin-bottom">
            <div class="container__item">
                <a [href]="'mailto:' + data.pairedUser.mail">{{data.pairedUser.mail}}</a>
            </div>
            <div class="container__item">{{data.pairedUser.address}}, {{data.pairedUser.city}} ({{data.pairedUser.province}})</div>
        </div>
        <div class="container container--no-padding container--margin-bottom">
            <div class="container__item">{{data.pairedUser.phone}}</div>
            <div class="container__item">{{data.pairedUser.schoolName}}</div>
        </div>
        <div class="container container--no-padding container--hor-end">
            <button (click)="cancelTransaction()" [disabled]="data.status === 'inCompletion'">Annulla</button>
            <button (click)="reportNotResponding()" [disabled]="!data.notRespondingEnabled || data.status === 'notResponding'">Non risponde</button>
            <button (click)="completeTransaction()">Completato</button>
        </div>
    </div>
</div> -->

<!-- CHAT -->
<!-- <div class="collapsible transaction__chat" *ngIf="data.status === 'pending' || data.status === 'notResponding'">
    <div class="transaction__chat-item-wrapper transaction__chat-item-wrapper--center" *ngIf="data.messages.length === 0">
        <div class="transaction__chat-item--clean">
            Scrivi il primo messaggio!
        </div>
    </div>
    <div class="transaction__chat-item-wrapper" *ngFor="let message of data.messages" [ngClass]="{ 'transaction__chat-item-wrapper--sent': message.sent }">
        <div class="transaction__chat-item">
            {{message.content}}
        </div>
    </div>
</div> -->

<!-- CHAT BAR -->
<!-- <div class="collapsible transaction__chat-bar" *ngIf="data.status === 'pending' || data.status === 'notResponding'">
    <div class="container">
        <input type="text" class="transaction__chat-input" [(ngModel)]="messageText" (keyup.enter)="sendMessage()">
        <button class="transaction__chat-button" octicon="arrow-right" (click)="sendMessage()"></button>
    </div>
</div> -->

<!-- COMPLETED -->
<!-- <div class="collapsible transaction__completed" *ngIf="data.status === 'completed'">
    <p>La transazione è stata completata.</p>
</div> -->